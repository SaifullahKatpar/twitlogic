<html>
<head>
    <title>TwitLogic Pfizer demo</title>

    <link rel="icon" href="../../favicon.ico" type="image/x-icon"/>
    <link rel="shortcut icon" href="../../favicon.ico" type="image/x-icon"/>

    <!-- See: http://times.usefulinc.com/2003/07/29-dashboardfoaf -->
    <link rel="meta" type="application/rdf+xml" title="FOAF" href="http://fortytwo.net/foaf#josh"/>
    <meta name="foaf:maker" content="foaf:mbox_sha1sum '1f62decdebec6594187ed1fa02355d9db33184fa'"/>

    <link media="screen" type="text/css" href="sparql-widget.css" rel="stylesheet"/>
    <script type="text/javascript" src="http://www.google.com/jsapi"></script>
    <script type="text/javascript" src="lib/jquery/1.4.2/jquery.min.js"></script>
    <script type="text/javascript" src="lib/timeago/0.8.2/jquery.timeago.js"></script>
    <script type="text/javascript" src="pfizer.js"></script>
    <script type="text/javascript">
        var results = { "head": { "vars": [ ] }, "results": { "bindings": [
            {
                "lon": { "type": "typed-literal", "datatype": "http:\/\/www.w3.org\/2001\/XMLSchema#double", "value": "-77.23696650000103" },
                "text": { "type": "literal", "value": "Dear email spammers. I don't need Viagra, watches, or pictures of my supposed wife. I will however take the humongou ... http:\/\/tmi.me\/JVMI" },
                "profileImage": { "type": "uri", "value": "http:\/\/a0.twimg.com\/profile_images\/211935016\/Red_Barbarian_normal.jpg" },
                "createdAt": { "type": "typed-literal", "datatype": "http:\/\/www.w3.org\/2001\/XMLSchema#dateTime", "value": "2010-08-24T19:36:33.000Z" },
                "tweet": { "type": "uri", "value": "http:\/\/twitlogic.fortytwo.net\/post\/twitter\/22025559120" },
                "screenName": { "type": "literal", "value": "Beardshanx" },
                "placeName": { "type": "literal", "value": "Maryland, US" },
                "lat": { "type": "typed-literal", "datatype": "http:\/\/www.w3.org\/2001\/XMLSchema#double", "value": "38.80482100000055" }
            },
            {
                "text": { "type": "literal", "value": "Viagra comes from water melon rind. #themoreyouknow" },
                "lon": { "type": "typed-literal", "datatype": "http:\/\/www.w3.org\/2001\/XMLSchema#double", "value": "-123.3224903" },
                "profileImage": { "type": "uri", "value": "http:\/\/a1.twimg.com\/profile_images\/1101196041\/cyclopse_normal.jpg" },
                "createdAt": { "type": "typed-literal", "datatype": "http:\/\/www.w3.org\/2001\/XMLSchema#dateTime", "value": "2010-08-20T22:17:04.000Z" },
                "tweet": { "type": "uri", "value": "http:\/\/twitlogic.fortytwo.net\/post\/twitter\/21699320161" },
                "screenName": { "type": "literal", "value": "imtrevonte" },
                "lat": { "type": "typed-literal", "datatype": "http:\/\/www.w3.org\/2001\/XMLSchema#double", "value": "47.04065447" }
            },
            {
                "text": { "type": "literal", "value": "Also, the Twitter spam that responds to the word iPad makes the iPad the new Viagra." },
                "lon": { "type": "typed-literal", "datatype": "http:\/\/www.w3.org\/2001\/XMLSchema#double", "value": "-81.51522" },
                "profileImage": { "type": "uri", "value": "http:\/\/a0.twimg.com\/profile_images\/1098032448\/me.sam1_normal.jpg" },
                "createdAt": { "type": "typed-literal", "datatype": "http:\/\/www.w3.org\/2001\/XMLSchema#dateTime", "value": "2010-08-21T03:47:08.000Z" },
                "tweet": { "type": "uri", "value": "http:\/\/twitlogic.fortytwo.net\/post\/twitter\/21719673562" },
                "screenName": { "type": "literal", "value": "SCMcDonnell" },
                "lat": { "type": "typed-literal", "datatype": "http:\/\/www.w3.org\/2001\/XMLSchema#double", "value": "28.74112" }
            },
            {
                "text": { "type": "literal", "value": "RT @TheOldSpiceGuy: Just took a viagra and about to do some damage as your lady gets the business end of my towel. #thesafewordisdeeper" },
                "lon": { "type": "typed-literal", "datatype": "http:\/\/www.w3.org\/2001\/XMLSchema#double", "value": "-86.533028" },
                "profileImage": { "type": "uri", "value": "http:\/\/a3.twimg.com\/profile_images\/1024247427\/handstand_normal.jpg" },
                "createdAt": { "type": "typed-literal", "datatype": "http:\/\/www.w3.org\/2001\/XMLSchema#dateTime", "value": "2010-08-21T04:40:10.000Z" },
                "tweet": { "type": "uri", "value": "http:\/\/twitlogic.fortytwo.net\/post\/twitter\/21723017934" },
                "screenName": { "type": "literal", "value": "phatley89" },
                "lat": { "type": "typed-literal", "datatype": "http:\/\/www.w3.org\/2001\/XMLSchema#double", "value": "39.186608" }
            },
            {
                "text": { "type": "literal", "value": "Kapper, shoarma, viagra: alles voor 5 Euro - http:\/\/moby.to\/5hp1dm" },
                "lon": { "type": "typed-literal", "datatype": "http:\/\/www.w3.org\/2001\/XMLSchema#double", "value": "4.963255" },
                "profileImage": { "type": "uri", "value": "http:\/\/a1.twimg.com\/profile_images\/1072172713\/IMG_2925_edited-1_KNIP_normal.jpg" },
                "createdAt": { "type": "typed-literal", "datatype": "http:\/\/www.w3.org\/2001\/XMLSchema#dateTime", "value": "2010-08-21T11:54:31.000Z" },
                "tweet": { "type": "uri", "value": "http:\/\/twitlogic.fortytwo.net\/post\/twitter\/21743131643" },
                "screenName": { "type": "literal", "value": "ivarzantinge" },
                "lat": { "type": "typed-literal", "datatype": "http:\/\/www.w3.org\/2001\/XMLSchema#double", "value": "52.394192" }
            },
            {
                "text": { "type": "literal", "value": "VIAGRA DONG! RT @ekobastiawan: @mu61 : aku ndak jadi ke JW bang... lokreeek balungku ..." },
                "lon": { "type": "typed-literal", "datatype": "http:\/\/www.w3.org\/2001\/XMLSchema#double", "value": "112.02351093" },
                "profileImage": { "type": "uri", "value": "http:\/\/a1.twimg.com\/profile_images\/1091590233\/my_normal.jpg" },
                "createdAt": { "type": "typed-literal", "datatype": "http:\/\/www.w3.org\/2001\/XMLSchema#dateTime", "value": "2010-08-21T14:33:59.000Z" },
                "tweet": { "type": "uri", "value": "http:\/\/twitlogic.fortytwo.net\/post\/twitter\/21752713100" },
                "screenName": { "type": "literal", "value": "mu61" },
                "lat": { "type": "typed-literal", "datatype": "http:\/\/www.w3.org\/2001\/XMLSchema#double", "value": "-7.81670121" }
            },
            {
                "text": { "type": "literal", "value": "lg d minie sama @aliefJW neh :) RT @ekobastiawan: huhaahhah.... jamu wae wes lek viagra bahaya :) RT @mu61: VIAGRA DONG! RT @ekobastiawan:" },
                "lon": { "type": "typed-literal", "datatype": "http:\/\/www.w3.org\/2001\/XMLSchema#double", "value": "112.02351093" },
                "profileImage": { "type": "uri", "value": "http:\/\/a1.twimg.com\/profile_images\/1091590233\/my_normal.jpg" },
                "createdAt": { "type": "typed-literal", "datatype": "http:\/\/www.w3.org\/2001\/XMLSchema#dateTime", "value": "2010-08-21T14:41:19.000Z" },
                "tweet": { "type": "uri", "value": "http:\/\/twitlogic.fortytwo.net\/post\/twitter\/21753259884" },
                "screenName": { "type": "literal", "value": "mu61" },
                "lat": { "type": "typed-literal", "datatype": "http:\/\/www.w3.org\/2001\/XMLSchema#double", "value": "-7.81670121" }
            },
            {
                "text": { "type": "literal", "value": "dokternya gak mandul ya. anal dia 3 dan dia tau cara ngeracik viagra RT @febbyfarr: Dih aku jg gamungkin sm dokternya orang dokternya mandul" },
                "lon": { "type": "typed-literal", "datatype": "http:\/\/www.w3.org\/2001\/XMLSchema#double", "value": "17.80663651" },
                "profileImage": { "type": "uri", "value": "http:\/\/a0.twimg.com\/profile_images\/1106359944\/40179_489765004615_760279615_6964774_5693940_n_normal.jpg" },
                "createdAt": { "type": "typed-literal", "datatype": "http:\/\/www.w3.org\/2001\/XMLSchema#dateTime", "value": "2010-08-21T17:35:05.000Z" },
                "tweet": { "type": "uri", "value": "http:\/\/twitlogic.fortytwo.net\/post\/twitter\/21765720112" },
                "screenName": { "type": "literal", "value": "adit1412" },
                "lat": { "type": "typed-literal", "datatype": "http:\/\/www.w3.org\/2001\/XMLSchema#double", "value": "59.24512255" }
            },
            {
                "text": { "type": "literal", "value": "Lol j u a mess RT @jquesmith: Wait a minute.... Women are taking Viagra?!?! What do u get out of it? #HardCooch #WhoWantsThat?" },
                "lon": { "type": "typed-literal", "datatype": "http:\/\/www.w3.org\/2001\/XMLSchema#double", "value": "-84.417016" },
                "profileImage": { "type": "uri", "value": "http:\/\/a2.twimg.com\/profile_images\/1079290618\/171628_normal.jpg" },
                "createdAt": { "type": "typed-literal", "datatype": "http:\/\/www.w3.org\/2001\/XMLSchema#dateTime", "value": "2010-08-21T22:52:08.000Z" },
                "tweet": { "type": "uri", "value": "http:\/\/twitlogic.fortytwo.net\/post\/twitter\/21783162743" },
                "screenName": { "type": "literal", "value": "ellzdotcom" },
                "lat": { "type": "typed-literal", "datatype": "http:\/\/www.w3.org\/2001\/XMLSchema#double", "value": "33.753949" }
            },
            {
                "text": { "type": "literal", "value": "I'm at The Viagra Triangle. http:\/\/4sq.com\/9VW78D" },
                "lon": { "type": "typed-literal", "datatype": "http:\/\/www.w3.org\/2001\/XMLSchema#double", "value": "-87.62818694" },
                "profileImage": { "type": "uri", "value": "http:\/\/a0.twimg.com\/profile_images\/734295472\/jimnewberry_normal.jpg" },
                "createdAt": { "type": "typed-literal", "datatype": "http:\/\/www.w3.org\/2001\/XMLSchema#dateTime", "value": "2010-08-21T23:15:48.000Z" },
                "tweet": { "type": "uri", "value": "http:\/\/twitlogic.fortytwo.net\/post\/twitter\/21784463850" },
                "screenName": { "type": "literal", "value": "JamesElliott" },
                "lat": { "type": "typed-literal", "datatype": "http:\/\/www.w3.org\/2001\/XMLSchema#double", "value": "41.90178195" }
            }
        ] } };

        // Note: beware of the same-origin policy.  The SPARQL endpoint must
        // reside in the same URI space as this web page.
        var sparqlEndpoint = "../../sparql";
        //        var sparqlEndpoint = "http://localhost:8182/sparql";
        //        var sparqlEndpoint = "http://allegrotwit.fortytwo.net:8182/sparql";
        //        var sparqlEndpoint = "http://twitlogic.fortytwo.net/sparql";

        var query = "PREFIX dc: <http://purl.org/dc/terms/>\n" +
                    "PREFIX foaf: <http://xmlns.com/foaf/0.1/>\n" +
                    "PREFIX geo: <http://www.w3.org/2003/01/geo/wgs84_pos#>\n" +
                    "PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>\n" +
                    "PREFIX sioc: <http://rdfs.org/sioc/ns#>\n" +
                    "SELECT DISTINCT ?tweet ?lon ?lat ?placeName ?text ?createdAt ?screenName ?profileImage WHERE {\n" +
                    "  ?tweet geo:location ?place .\n" +
                    "  ?place geo:long ?lon .\n" +
                    "  ?place geo:lat ?lat .\n" +
                    "  ?tweet sioc:content ?text .\n" +
                    "  ?tweet dc:created ?createdAt .\n" +
                    "  ?tweet sioc:has_creator ?account .\n" +
                    "  ?account sioc:id ?screenName .\n" +
                    "  ?account sioc:account_of ?person .\n" +
                    "  #?person foaf:name ?username .\n" +
                    "  ?person  foaf:depiction ?profileImage .\n" +
                    "  OPTIONAL { ?place dc:title ?placeName . } .\n" +
                    "} ORDER BY DESC(?createdAt)\n" +
                    "LIMIT 30";

        google.load("visualization", "1", {packages:["map"]});
        google.setOnLoadCallback(googleReady);

        $(document).ready(function() {
            documentReady();
        });

        var ready = 0;

        function googleReady() {
            //alert("google ready");
            ready++;
            doQuery();
        }

        function documentReady() {
            //alert("doc ready");
            ready++;
            doQuery();
        }

        function doQuery() {
            if (2 != ready) {
                return;
            }

            queryForTweets(sparqlEndpoint, query, 10000);
        }

        function drawMap(bindings) {
            //var bindings = results.results.bindings;

            var data = new google.visualization.DataTable();
            data.addColumn('number', 'Lat');
            data.addColumn('number', 'Lon');
            data.addColumn('string', 'Name');

            data.addRows(bindings.length);

            var tmp = document.getElementById("tmp");
            for (var i = 0; i < bindings.length; i++) {
                var b = bindings[i];

                data.setCell(i, 0, parseFloat(b.lat.value));
                data.setCell(i, 1, parseFloat(b.lon.value));

                var parent = document.createElement("div");
                var el = constructTweetElement(b);
                parent.appendChild(el);
                //data.setCell(i, 2, Form.serialize(el));
                data.setCell(i, 2, parent.innerHTML);
                //data.setCell(i, 2, "<div onclick=\"alert(42);\" id=\"tweet" + i + "\"></div>");
                tmp.appendChild(el);
            }

            var map = new google.visualization.Map(document.getElementById('map_div'));
            map.draw(data, {showTip: true});
        }
    </script>
</head>

<body>
<div id="map_div" style="width: 700px; height: 500px"></div>
<div id="tmp"></div>
</body>
</html>